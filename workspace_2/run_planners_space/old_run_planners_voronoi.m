addpath(genpath("./"));

%% 1
% In order to prevent contamination of data
% delete the out\ dir -> workspace_2\run_planners_space\out\
% if changes to the script are made

% if ~isfolder("workspace_2\run_planners_space\out\")
% 
%     mkdir("workspace_2\run_planners_space\out\");
%     mkdir("workspace_2\run_planners_space\out\a_star");
%     mkdir("workspace_2\run_planners_space\out\voronoi_plan");
%     mkdir("workspace_2\run_planners_space\out\dijkstra");
%     mkdir("workspace_2\run_planners_space\out\theta_star");
%     mkdir("workspace_2\run_planners_space\out\gbfs");
% else
%     return;
% end

if ~isfolder("workspace_2\run_planners_space\out\voronoi_plan")
    mkdir("workspace_2\run_planners_space\out\voronoi_plan");
end
%% 2
planners = [
    % "a_star",       ...
    "voronoi_plan", ...
    % "dijkstra",     ...
    % "theta_star",   ...
    % "gbfs"
];

%% start & goal can be checked  in tests/startNgoalPoints
starts = [
    3,  3; ...
    11, 3; ...
    20, 3; ...
    29, 3; ...
    38, 3; ...
    
    3,  4; ...
    11, 4; ...
    20, 4; ...
    29, 4; ...
    38, 4; ...
    
    3,  5; ...
    11, 5; ...
    20, 5; ...
    29, 5; ...
    38, 5; ...
];

goals = [
    3,	35; ...
    4,	35; ...
    5,	35; ...
    6,	35; ...
    7,	35; ...
    8,	35; ...
    9,	35; ...
    10,	35; ...
    11,	35; ...
    12,	35; ...
    13,	35; ...
    14,	35; ...
    15,	35; ...
    16,	35; ...
    17,	35; ...
    18,	35; ...
    19,	35; ...
    20,	35; ...
    21,	35; ...
    22,	35; ...
    23,	35; ...
    24,	35; ...
    25,	35; ...
    26,	35; ...
    27,	35; ...
    28,	35; ...
    29,	35; ...
    30,	35; ...
    31,	35; ...
    32,	35; ...
    33,	35; ...
    34,	35; ...
    35,	35; ...
    36,	35; ...
    37,	35; ...
    38,	35; ...
    3,	36; ...
    4,	36; ...
    5,	36; ...
    6,	36; ...
    7,	36; ...
    8,	36; ...
    9,	36; ...
    10,	36; ...
    11,	36; ...
    12,	36; ...
    13,	36; ...
    14,	36; ...
    15,	36; ...
    16,	36; ...
    17,	36; ...
    18,	36; ...
    19,	36; ...
    20,	36; ...
    21,	36; ...
    22,	36; ...
    23,	36; ...
    24,	36; ...
    25,	36; ...
    26,	36; ...
    27,	36; ...
    28,	36; ...
    29,	36; ...
    30,	36; ...
    31,	36; ...
    32,	36; ...
    33,	36; ...
    34,	36; ...
    35,	36; ...
    36,	36; ...
    37,	36; ...
    38,	36; ...
    3,	37; ...
    4,	37; ...
    5,	37; ...
    6,	37; ...
    7,	37; ...
    8,	37; ...
    9,	37; ...
    10,	37; ...
    11,	37; ...
    12,	37; ...
    13,	37; ...
    14,	37; ...
    15,	37; ...
    16,	37; ...
    17,	37; ...
    18,	37; ...
    19,	37; ...
    20,	37; ...
    21,	37; ...
    22,	37; ...
    23,	37; ...
    24,	37; ...
    25,	37; ...
    26,	37; ...
    27,	37; ...
    28,	37; ...
    29,	37; ...
    30,	37; ...
    31,	37; ...
    32,	37; ...
    33,	37; ...
    34,	37; ...
    35,	37; ...
    36,	37; ...
    37,	37; ...
    38,	37; ...
    3,	38; ...
    4,	38; ...
    5,	38; ...
    6,	38; ...
    7,	38; ...
    8,	38; ...
    9,	38; ...
    10,	38; ...
    11,	38; ...
    12,	38; ...
    13,	38; ...
    14,	38; ...
    15,	38; ...
    16,	38; ...
    17,	38; ...
    18,	38; ...
    19,	38; ...
    20,	38; ...
    21,	38; ...
    22,	38; ...
    23,	38; ...
    24,	38; ...
    25,	38; ...
    26,	38; ...
    27,	38; ...
    28,	38; ...
    29,	38; ...
    30,	38; ...
    31,	38; ...
    32,	38; ...
    33,	38; ...
    34,	38; ...
    35,	38; ...
    36,	38; ...
    37,	38; ...
    38,	38; ...
];

dataFiles = dir("workspace_2\map_space\grid_maps\");
dataFiles = dataFiles(~matches({dataFiles.name}, [".", ".."]), :);
sucsess_counter = 0;
for map_i = 1:length(dataFiles)
    F = dataFiles(map_i);
    disp(F.name); %%%%% %%%%% %%%%% print
    name = sprintf('workspace_2\\map_space\\grid_maps\\%s', F.name);
    load(name)
 
    map_size = size(grid_map);
    G = 1;

    for planner_i = 1:length(planners)
        planner_name = planners(planner_i);
        disp(planner_name); %%%%% %%%%% %%%%% print


        for start_i = 1:length(starts)
            start = starts(start_i,:);
            if grid_map(start(1), start(2)) == 2
                    continue;
            end

            

            for goal_i = 1:length(goals)
                goal  = goals(goal_i,:);
        
                if grid_map(goal(1), goal(2)) == 2
                    continue;
                end
                
                planner = str2func(planner_name);
                [path, flag, cost, expand] = planner(grid_map, start, goal);
                

                    if flag == 1
                        sucsess_counter = sucsess_counter + 1;
                        save(sprintf(...
                            "workspace_2/run_planners_space/out/%s/map_%02d_start_%02d%02d_goal_%02d%2d.mat", ...
                            planner_name, map_i, start(1), start(2), goal(1), goal(2)), ...
                            ...
                            "planner_name", "path", "start", "goal", "grid_map", "cost" ...
                        ) % save
                    
                    else
                        %%%%% %%%%% %%%%% print
                        % fprintf("failed:  %s  map_%02d_start_%02d_goal_%02d\n\n", planner_name, map_i, start_i, goal_i);
                     end % flag == 1

            end % goals

        end % starts


    end % planners
end % dataFiles

disp(sucsess_counter);